
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>mmdps.vis.braincircos &#8212; MMDPS 1.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for mmdps.vis.braincircos</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageFont</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">mmdps.proc</span> <span class="k">import</span> <span class="n">atlas</span><span class="p">,</span> <span class="n">job</span>
<span class="kn">from</span> <span class="nn">mmdps.util.loadsave</span> <span class="k">import</span> <span class="n">load_rawtext</span><span class="p">,</span> <span class="n">save_rawtext</span>
<span class="kn">from</span> <span class="nn">mmdps.util</span> <span class="k">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">mmdps</span> <span class="k">import</span> <span class="n">rootconfig</span>

<span class="n">CircosConfigFolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootconfig</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;braincircos&#39;</span><span class="p">,</span> <span class="s1">&#39;simpleconfig&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="color_to_str"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.color_to_str">[docs]</a><span class="k">def</span> <span class="nf">color_to_str</span><span class="p">(</span><span class="n">color</span><span class="p">):</span>
	<span class="k">return</span> <span class="s1">&#39;color=(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>

<div class="viewcode-block" id="Chromosome"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.Chromosome">[docs]</a><span class="k">class</span> <span class="nc">Chromosome</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atlasobj</span><span class="p">,</span> <span class="n">chrname</span><span class="p">,</span> <span class="n">configdict</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span> <span class="o">=</span> <span class="n">atlasobj</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">configdict</span> <span class="o">=</span> <span class="n">configdict</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chrname</span> <span class="o">=</span> <span class="n">chrname</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bandtuples</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">build_bands</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">build_bandtuples</span><span class="p">()</span>

<div class="viewcode-block" id="Chromosome.build_bands"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.Chromosome.build_bands">[docs]</a>	<span class="k">def</span> <span class="nf">build_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="s1">&#39;ticks&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span><span class="o">.</span><span class="n">ticks_to_indexes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;ticks&#39;</span><span class="p">])</span>
		<span class="k">elif</span> <span class="s1">&#39;indexes&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;indexes&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Use ticks or indexes to specify brain regions.&#39;</span><span class="p">)</span>
			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;bad chromosome&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Chromosome.build_bandtuples"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.Chromosome.build_bandtuples">[docs]</a>	<span class="k">def</span> <span class="nf">build_bandtuples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">tuples</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">)):</span>
			<span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chrname</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bandtuples</span> <span class="o">=</span> <span class="n">tuples</span></div></div>

<div class="viewcode-block" id="BrainParts"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.BrainParts">[docs]</a><span class="k">class</span> <span class="nc">BrainParts</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configdict</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">configdict</span> <span class="o">=</span> <span class="n">configdict</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">atlasname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atlasname</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">build_all</span><span class="p">()</span>

<div class="viewcode-block" id="BrainParts.build_all"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.BrainParts.build_all">[docs]</a>	<span class="k">def</span> <span class="nf">build_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">leftconfig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">leftconfig</span><span class="p">:</span>
			<span class="n">lchrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_chromosomes</span><span class="p">(</span><span class="s1">&#39;L_&#39;</span><span class="p">,</span> <span class="n">leftconfig</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lchrs</span>
		<span class="n">rightconfig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">rightconfig</span><span class="p">:</span>
			<span class="n">rchrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_chromosomes</span><span class="p">(</span><span class="s1">&#39;R_&#39;</span><span class="p">,</span> <span class="n">rightconfig</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rchrs</span>
		<span class="n">centerconfig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">centerconfig</span><span class="p">:</span>
			<span class="n">cchrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_chromosomes</span><span class="p">(</span><span class="s1">&#39;C_&#39;</span><span class="p">,</span> <span class="n">centerconfig</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cchrs</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lchrs</span> <span class="o">+</span> <span class="n">rchrs</span></div>

<div class="viewcode-block" id="BrainParts.build_chromosomes"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.BrainParts.build_chromosomes">[docs]</a>	<span class="k">def</span> <span class="nf">build_chromosomes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
		<span class="n">sections</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;sections&#39;</span><span class="p">]</span>
		<span class="n">chromosomes</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sectionconf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
			<span class="n">chrname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
			<span class="n">chromo</span> <span class="o">=</span> <span class="n">Chromosome</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span><span class="p">,</span> <span class="n">chrname</span><span class="p">,</span> <span class="n">sectionconf</span><span class="p">)</span>
			<span class="n">chromosomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromo</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">chromosomes</span></div>

<div class="viewcode-block" id="BrainParts.get_region_list"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.BrainParts.get_region_list">[docs]</a>	<span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a list of regions in order plotted by circos</span>
<span class="sd">		Left and right regions are interleaved</span>
<span class="sd">		Also return the second element as a list of no. of nodes in each lobe</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">leftconfig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
		<span class="n">rightconfig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
		<span class="n">region_list</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">nodeCount</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">secIdx</span><span class="p">,</span> <span class="n">section</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leftconfig</span><span class="p">[</span><span class="s1">&#39;sections&#39;</span><span class="p">]):</span>
			<span class="n">nodeCount</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;ticks&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
			<span class="k">for</span> <span class="n">tickIdx</span><span class="p">,</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;ticks&#39;</span><span class="p">]):</span>
				<span class="c1"># left first</span>
				<span class="n">region_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span>
				<span class="n">region_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rightconfig</span><span class="p">[</span><span class="s1">&#39;sections&#39;</span><span class="p">][</span><span class="n">secIdx</span><span class="p">][</span><span class="s1">&#39;ticks&#39;</span><span class="p">][</span><span class="n">tickIdx</span><span class="p">])</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">region_list</span><span class="p">,</span> <span class="n">nodeCount</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="CircosConfigChromosome"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigChromosome">[docs]</a><span class="k">class</span> <span class="nc">CircosConfigChromosome</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brainparts</span><span class="p">,</span> <span class="n">colorlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">brainparts</span> <span class="o">=</span> <span class="n">brainparts</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brainparts</span><span class="o">.</span><span class="n">atlasobj</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brainparts</span><span class="o">.</span><span class="n">chrdict</span>
		<span class="k">if</span> <span class="n">colorlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">colorlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grey&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span><span class="o">.</span><span class="n">count</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">colorlist</span> <span class="o">=</span> <span class="n">colorlist</span>

<div class="viewcode-block" id="CircosConfigChromosome.write_karyotype"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigChromosome.write_karyotype">[docs]</a>	<span class="k">def</span> <span class="nf">write_karyotype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
		<span class="n">chrfmt</span> <span class="o">=</span> <span class="s1">&#39;chr - </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span>  <span class="c1"># chr - L_1 L 0 54 green</span>
		<span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]:</span>
			<span class="n">chrline</span> <span class="o">=</span> <span class="n">chrfmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chromosome</span><span class="o">.</span><span class="n">chrname</span><span class="p">,</span> <span class="n">chromosome</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">chromosome</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
			<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chrline</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]):</span>
			<span class="n">chrline</span> <span class="o">=</span> <span class="n">chrfmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chromosome</span><span class="o">.</span><span class="n">chrname</span><span class="p">,</span> <span class="n">chromosome</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">chromosome</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
			<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chrline</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

		<span class="n">bandfmt</span> <span class="o">=</span> <span class="s1">&#39;band </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span>  <span class="c1"># band L_1 L1 L1 0 1 grey</span>
		<span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chromosome</span><span class="o">.</span><span class="n">count</span><span class="p">):</span>
				<span class="n">atlasindex</span> <span class="o">=</span> <span class="n">chromosome</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="n">bandtuple</span> <span class="o">=</span> <span class="n">chromosome</span><span class="o">.</span><span class="n">bandtuples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="n">atlastick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span><span class="o">.</span><span class="n">ticks</span><span class="p">[</span><span class="n">atlasindex</span><span class="p">]</span>
				<span class="n">bandline</span> <span class="o">=</span> <span class="n">bandfmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bandtuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atlastick</span><span class="p">,</span> <span class="n">atlastick</span><span class="p">,</span> <span class="n">bandtuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bandtuple</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorlist</span><span class="p">[</span><span class="n">atlasindex</span><span class="p">])</span>
				<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bandline</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosConfigChromosome.write_labels"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigChromosome.write_labels">[docs]</a>	<span class="k">def</span> <span class="nf">write_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
		<span class="n">labelfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span>  <span class="c1"># L_1 0 1 L1</span>
		<span class="k">for</span> <span class="n">chromosome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chromosome</span><span class="o">.</span><span class="n">count</span><span class="p">):</span>
				<span class="n">atlasindex</span> <span class="o">=</span> <span class="n">chromosome</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="n">bandtuple</span> <span class="o">=</span> <span class="n">chromosome</span><span class="o">.</span><span class="n">bandtuples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="n">atlastick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span><span class="o">.</span><span class="n">ticks</span><span class="p">[</span><span class="n">atlasindex</span><span class="p">]</span>
				<span class="n">labelline</span> <span class="o">=</span> <span class="n">labelfmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bandtuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bandtuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bandtuple</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">atlastick</span><span class="p">)</span>
				<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">labelline</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosConfigChromosome.write"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigChromosome.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfolder</span><span class="p">):</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outfolder</span><span class="p">,</span> <span class="s1">&#39;karyotype.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">write_karyotype</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outfolder</span><span class="p">,</span> <span class="s1">&#39;atlas.labels.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">write_labels</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="CircosConfigFile"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigFile">[docs]</a><span class="k">class</span> <span class="nc">CircosConfigFile</span><span class="p">:</span>
	<span class="n">PlotFmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">	&lt;plot&gt;</span>
<span class="s2">	type = heatmap</span>
<span class="s2">	stroke_thickness = 1p</span>
<span class="s2">	stroke_color = black</span>
<span class="s2">	file = </span><span class="si">{file}</span><span class="s2"></span>
<span class="s2">	r1 = </span><span class="si">{r1}</span><span class="s2"></span>
<span class="s2">	r0 = </span><span class="si">{r0}</span><span class="s2"></span>
<span class="s2">	&lt;/plot&gt;</span>
<span class="s2">	&quot;&quot;&quot;</span>
	<span class="n">LinkFmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">	&lt;link&gt;</span>
<span class="s2">	file = </span><span class="si">{file}</span><span class="s2"></span>
<span class="s2">	radius = </span><span class="si">{radius}</span><span class="s2"></span>
<span class="s2">	bezier_radius = 0r</span>
<span class="s2">	thickness = </span><span class="si">{thickness}</span><span class="s2"></span>
<span class="s2">	&lt;/link&gt;</span>
<span class="s2">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plotconfs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">linkconfs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">label_size</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">linkThickness</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># default link thickness</span>

<div class="viewcode-block" id="CircosConfigFile.add_plot"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigFile.add_plot">[docs]</a>	<span class="k">def</span> <span class="nf">add_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plotconfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosConfigFile.add_link"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigFile.add_link">[docs]</a>	<span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">linkconfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosConfigFile.build_circos_conf"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigFile.build_circos_conf">[docs]</a>	<span class="k">def</span> <span class="nf">build_circos_conf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotstrs</span><span class="p">,</span> <span class="n">linkstrs</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">circos_template</span> <span class="o">=</span> <span class="n">load_rawtext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CircosConfigFolder</span><span class="p">,</span> <span class="s1">&#39;circos_template.conf&#39;</span><span class="p">))</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">circos_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plotsstr</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotstrs</span><span class="p">),</span> <span class="n">linksstr</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">linkstrs</span><span class="p">))</span></div>

<div class="viewcode-block" id="CircosConfigFile.customizeSize"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigFile.customizeSize">[docs]</a>	<span class="k">def</span> <span class="nf">customizeSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_size</span><span class="p">,</span> <span class="n">linkThickness</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">label_size</span> <span class="o">=</span> <span class="n">label_size</span>
		<span class="k">if</span> <span class="n">linkThickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">linkThickness</span> <span class="o">=</span> <span class="n">linkThickness</span></div>

<div class="viewcode-block" id="CircosConfigFile.customized_rewrite"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigFile.customized_rewrite">[docs]</a>	<span class="k">def</span> <span class="nf">customized_rewrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfolder</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Re-generate circos.conf to update parameters</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outfolder</span><span class="p">,</span> <span class="s1">&#39;circos.conf&#39;</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outfolder</span><span class="p">,</span> <span class="s1">&#39;circos.conf.bk&#39;</span><span class="p">))</span>
		<span class="n">confFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outfolder</span><span class="p">,</span> <span class="s1">&#39;circos.conf&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outfolder</span><span class="p">,</span> <span class="s1">&#39;circos.conf.bk&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">bk</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">bk</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;label_size&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
					<span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_size</span><span class="p">)</span>
				<span class="n">confFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
		<span class="n">confFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outfolder</span><span class="p">,</span> <span class="s1">&#39;circos.conf.bk&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="CircosConfigFile.write"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosConfigFile.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfolder</span><span class="p">):</span>
		<span class="n">plotstrs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">rfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">r&#39;</span>
		<span class="n">plotwidth</span> <span class="o">=</span> <span class="mf">0.05</span>
		<span class="k">for</span> <span class="n">iplot</span><span class="p">,</span> <span class="n">plotconf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotconfs</span><span class="p">):</span>
			<span class="n">r1f</span> <span class="o">=</span> <span class="mf">0.99</span> <span class="o">-</span> <span class="n">iplot</span> <span class="o">*</span> <span class="n">plotwidth</span>
			<span class="n">r0f</span> <span class="o">=</span> <span class="n">r1f</span> <span class="o">-</span> <span class="mf">0.04</span>
			<span class="n">plotstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PlotFmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">plotconf</span><span class="p">,</span> <span class="n">r1</span><span class="o">=</span><span class="n">rfmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r1f</span><span class="p">),</span> <span class="n">r0</span><span class="o">=</span><span class="n">rfmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r0f</span><span class="p">))</span>
			<span class="n">plotstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plotstr</span><span class="p">)</span>
		<span class="n">nplot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotconfs</span><span class="p">)</span>
		<span class="n">linkstrs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">linkconf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkconfs</span><span class="p">:</span>
			<span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">nplot</span> <span class="o">*</span> <span class="n">plotwidth</span>
			<span class="n">linkstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LinkFmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">linkconf</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">rfmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span> <span class="n">thickness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkThickness</span><span class="p">)</span>
			<span class="n">linkstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linkstr</span><span class="p">)</span>
		<span class="n">finalstring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_circos_conf</span><span class="p">(</span><span class="n">plotstrs</span><span class="p">,</span> <span class="n">linkstrs</span><span class="p">)</span>
		<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outfolder</span><span class="p">,</span> <span class="s1">&#39;circos.conf&#39;</span><span class="p">)</span>
		<span class="n">save_rawtext</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">finalstring</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="CircosLink"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosLink">[docs]</a><span class="k">class</span> <span class="nc">CircosLink</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">valuerange</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
		<span class="k">if</span> <span class="n">valuerange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1"># check for all same value</span>
			<span class="n">unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">valuerange</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">valuerange</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">valuerange</span> <span class="o">=</span> <span class="n">valuerange</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">brainparts</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">atlasobj</span><span class="o">.</span><span class="n">get_brainparts</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brainparts</span><span class="o">.</span><span class="n">chrdict</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">data</span>

<div class="viewcode-block" id="CircosLink.get_mask"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosLink.get_mask">[docs]</a>	<span class="k">def</span> <span class="nf">get_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
		<span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
		<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">mask</span></div>

<div class="viewcode-block" id="CircosLink.get_line"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosLink.get_line">[docs]</a>	<span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chrA</span><span class="p">,</span> <span class="n">idxA</span><span class="p">,</span> <span class="n">chrB</span><span class="p">,</span> <span class="n">idxB</span><span class="p">):</span>
		<span class="n">linkfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span>  <span class="c1"># L_1 0 1 L_1 1 2 color=(10,10,10)</span>
		<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_color</span><span class="p">(</span><span class="n">chrA</span><span class="p">,</span> <span class="n">idxA</span><span class="p">,</span> <span class="n">chrB</span><span class="p">,</span> <span class="n">idxB</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">colorstr</span> <span class="o">=</span> <span class="n">color_to_str</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
			<span class="n">linkline</span> <span class="o">=</span> <span class="n">linkfmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">chrA</span><span class="o">.</span><span class="n">bandtuples</span><span class="p">[</span><span class="n">idxA</span><span class="p">],</span> <span class="o">*</span><span class="n">chrB</span><span class="o">.</span><span class="n">bandtuples</span><span class="p">[</span><span class="n">idxB</span><span class="p">],</span> <span class="n">colorstr</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">linkline</span></div>

<div class="viewcode-block" id="CircosLink.get_color"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosLink.get_color">[docs]</a>	<span class="k">def</span> <span class="nf">get_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chrA</span><span class="p">,</span> <span class="n">idxA</span><span class="p">,</span> <span class="n">chrB</span><span class="p">,</span> <span class="n">idxB</span><span class="p">):</span>
		<span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">chrA</span><span class="p">,</span> <span class="n">idxA</span><span class="p">,</span> <span class="n">chrB</span><span class="p">,</span> <span class="n">idxB</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">()(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">color</span></div>

<div class="viewcode-block" id="CircosLink.get_value"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosLink.get_value">[docs]</a>	<span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chrA</span><span class="p">,</span> <span class="n">idxA</span><span class="p">,</span> <span class="n">chrB</span><span class="p">,</span> <span class="n">idxB</span><span class="p">):</span>
		<span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rowcol</span><span class="p">(</span><span class="n">chrA</span><span class="p">,</span> <span class="n">idxA</span><span class="p">,</span> <span class="n">chrB</span><span class="p">,</span> <span class="n">idxB</span><span class="p">)</span>
		<span class="n">bmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">bmask</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CircosLink.get_rowcol"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosLink.get_rowcol">[docs]</a>	<span class="k">def</span> <span class="nf">get_rowcol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chrA</span><span class="p">,</span> <span class="n">idxA</span><span class="p">,</span> <span class="n">chrB</span><span class="p">,</span> <span class="n">idxB</span><span class="p">):</span>
		<span class="n">row</span> <span class="o">=</span> <span class="n">chrA</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">idxA</span><span class="p">]</span>
		<span class="n">col</span> <span class="o">=</span> <span class="n">chrB</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">idxB</span><span class="p">]</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosLink.map_value"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosLink.map_value">[docs]</a>	<span class="k">def</span> <span class="nf">map_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="n">valuerange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valuerange</span>
		<span class="n">a</span> <span class="o">=</span> <span class="n">valuerange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">b</span> <span class="o">=</span> <span class="n">valuerange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">value</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosLink.get_cmap"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosLink.get_cmap">[docs]</a>	<span class="k">def</span> <span class="nf">get_cmap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span></div>

<div class="viewcode-block" id="CircosLink.write"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosLink.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfullpath</span><span class="p">):</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfullpath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mask</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">chrA</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
				<span class="k">for</span> <span class="n">idxA</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chrA</span><span class="o">.</span><span class="n">count</span><span class="p">):</span>
					<span class="k">for</span> <span class="n">chrB</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
						<span class="k">for</span> <span class="n">idxB</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chrB</span><span class="o">.</span><span class="n">count</span><span class="p">):</span>
							<span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_line</span><span class="p">(</span><span class="n">chrA</span><span class="p">,</span> <span class="n">idxA</span><span class="p">,</span> <span class="n">chrB</span><span class="p">,</span> <span class="n">idxB</span><span class="p">)</span>
							<span class="k">if</span> <span class="n">line</span><span class="p">:</span>
								<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
								<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="CircosValue"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosValue">[docs]</a><span class="k">class</span> <span class="nc">CircosValue</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">valuerange</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmap_str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">brainparts</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">atlasobj</span><span class="o">.</span><span class="n">get_brainparts</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">valuerange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">valuerange</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">valuerange</span> <span class="o">=</span> <span class="n">valuerange</span>
		<span class="k">if</span> <span class="n">cmap_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap_str</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Reds</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brainparts</span><span class="o">.</span><span class="n">chrdict</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">data</span>

<div class="viewcode-block" id="CircosValue.get_line"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosValue.get_line">[docs]</a>	<span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chro</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
		<span class="n">valuefmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span>  <span class="c1"># L_1 0 1 0.312 color=(10,10,10)</span>
		<span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">chro</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
		<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_color</span><span class="p">(</span><span class="n">chro</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
		<span class="n">colorstr</span> <span class="o">=</span> <span class="n">color_to_str</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="n">valueline</span> <span class="o">=</span> <span class="n">valuefmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">chro</span><span class="o">.</span><span class="n">bandtuples</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">value</span><span class="p">,</span> <span class="n">colorstr</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">valueline</span></div>

<div class="viewcode-block" id="CircosValue.get_value"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosValue.get_value">[docs]</a>	<span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chro</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">chro</span><span class="p">,</span> <span class="n">idx</span><span class="p">)]</span></div>

<div class="viewcode-block" id="CircosValue.get_index"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosValue.get_index">[docs]</a>	<span class="k">def</span> <span class="nf">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chro</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">chro</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>

<div class="viewcode-block" id="CircosValue.get_color"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosValue.get_color">[docs]</a>	<span class="k">def</span> <span class="nf">get_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chro</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
		<span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">chro</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
		<span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">color</span></div>

<div class="viewcode-block" id="CircosValue.map_value"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosValue.map_value">[docs]</a>	<span class="k">def</span> <span class="nf">map_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valuerange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valuerange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">value</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosValue.set_cmap"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosValue.set_cmap">[docs]</a>	<span class="k">def</span> <span class="nf">set_cmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap_str</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">cmap_str</span> <span class="o">==</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Blues</span>
		<span class="k">elif</span> <span class="n">cmap_str</span> <span class="o">==</span> <span class="s1">&#39;coolwarm&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Reds</span></div>

<div class="viewcode-block" id="CircosValue.write"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosValue.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfullpath</span><span class="p">):</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfullpath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">chro</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrdict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
				<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chro</span><span class="o">.</span><span class="n">count</span><span class="p">):</span>
					<span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_line</span><span class="p">(</span><span class="n">chro</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
					<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
					<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="CircosPlotBuilder"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder">[docs]</a><span class="k">class</span> <span class="nc">CircosPlotBuilder</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atlasobj</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">outfilepath</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span> <span class="o">=</span> <span class="n">atlasobj</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">brainparts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span><span class="o">.</span><span class="n">get_brainparts</span><span class="p">()</span> <span class="c1"># circosparts.json file in each atlas&#39;s folder</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
		<span class="k">if</span> <span class="n">outfilepath</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.png&#39;</span><span class="p">:</span>
			<span class="n">outfilepath</span> <span class="o">=</span> <span class="n">outfilepath</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">outfilepath</span> <span class="o">=</span> <span class="n">outfilepath</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">outfolder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outfilepath</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">circosfolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfolder</span><span class="p">,</span> <span class="s1">&#39;circosdata&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfilename</span><span class="p">)</span>
		<span class="n">path</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circosfolder</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">circosConfigFile</span> <span class="o">=</span> <span class="n">CircosConfigFile</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">circoslinks</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">circosvalues</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">customizedSizes</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">atlasobj</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;bnatlas&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">customizeSize</span><span class="p">(</span><span class="n">label_size</span> <span class="o">=</span> <span class="s1">&#39;20p&#39;</span><span class="p">,</span> <span class="n">linkThickness</span> <span class="o">=</span> <span class="s1">&#39;10p&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">atlasobj</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;aicha&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">customizeSize</span><span class="p">(</span><span class="n">label_size</span> <span class="o">=</span> <span class="s1">&#39;10p&#39;</span><span class="p">,</span> <span class="n">linkThickness</span> <span class="o">=</span> <span class="s1">&#39;5p&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CircosPlotBuilder.customizeSize"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder.customizeSize">[docs]</a>	<span class="k">def</span> <span class="nf">customizeSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ideogram_radius</span> <span class="o">=</span> <span class="s1">&#39;0.8r&#39;</span><span class="p">,</span> <span class="n">label_size</span> <span class="o">=</span> <span class="s1">&#39;40p&#39;</span><span class="p">,</span> <span class="n">linkThickness</span> <span class="o">=</span> <span class="s1">&#39;20p&#39;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		input ideogram_radius as a string like &#39;0.80r&#39;</span>
<span class="sd">			- ideogram_radius controls the size of the whole ring</span>
<span class="sd">		input label_size as a string like &#39;40p&#39;</span>
<span class="sd">			- label_size controls the font size of the ticks (L1, R2 etc.)</span>
<span class="sd">		input linkThickness as an integer like 20p</span>
<span class="sd">			- linkThickness controls the thickness of network links(edges)</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">customizedSizes</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">ideogram_radius</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">circosConfigFile</span><span class="o">.</span><span class="n">customizeSize</span><span class="p">(</span><span class="n">label_size</span><span class="p">,</span> <span class="n">linkThickness</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosPlotBuilder.fullpath"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder.fullpath">[docs]</a>	<span class="k">def</span> <span class="nf">fullpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circosfolder</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosPlotBuilder.add_circosvalue"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder.add_circosvalue">[docs]</a>	<span class="k">def</span> <span class="nf">add_circosvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circosvalue</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Check unique value amount. If all values are the same, do not add this value </span>
<span class="sd">		since circos will crash when plotting same values</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">circosvalue</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">circosvalues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circosvalue</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosPlotBuilder.add_circoslink"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder.add_circoslink">[docs]</a>	<span class="k">def</span> <span class="nf">add_circoslink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circoslink</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">circoslinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circoslink</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosPlotBuilder.get_colorlist"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder.get_colorlist">[docs]</a>	<span class="k">def</span> <span class="nf">get_colorlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">[</span><span class="s1">&#39;grey&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlasobj</span><span class="o">.</span><span class="n">count</span></div>

<div class="viewcode-block" id="CircosPlotBuilder.copy_files"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder.copy_files">[docs]</a>	<span class="k">def</span> <span class="nf">copy_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Copy circos basic ideogram config files.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">configfolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootconfig</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;braincircos&#39;</span><span class="p">,</span> <span class="s1">&#39;simpleconfig&#39;</span><span class="p">)</span>
		<span class="n">configfiles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ideogram.conf&#39;</span><span class="p">,</span> <span class="s1">&#39;ticks.conf&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">configfiles</span><span class="p">:</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">configfolder</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customizedSizes</span><span class="p">:</span>
			<span class="c1"># adjust ideogram radius</span>
			<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="s1">&#39;ideogram.conf&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="s1">&#39;ideogram.conf.bk&#39;</span><span class="p">))</span>
			<span class="n">ideogramFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="s1">&#39;ideogram.conf&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="s1">&#39;ideogram.conf.bk&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">bk</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">bk</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
					<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;label_radius&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
						<span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
					<span class="n">ideogramFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
			<span class="n">ideogramFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="s1">&#39;ideogram.conf.bk&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="CircosPlotBuilder.write_files"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder.write_files">[docs]</a>	<span class="k">def</span> <span class="nf">write_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write net links and attributes to files.</span>
<span class="sd">		self.circosConfigFile would generate the circos.conf file.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">circosvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circosvalues</span><span class="p">):</span>
			<span class="n">currentFile</span> <span class="o">=</span> <span class="s1">&#39;attr</span><span class="si">{}</span><span class="s1">.value.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">circosConfigFile</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">currentFile</span><span class="p">)</span>
			<span class="n">circosvalue</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="n">currentFile</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">circoslink</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circoslinks</span><span class="p">):</span>
			<span class="n">currentFile</span> <span class="o">=</span> <span class="s1">&#39;net</span><span class="si">{}</span><span class="s1">.link.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">circosConfigFile</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">currentFile</span><span class="p">)</span>
			<span class="n">circoslink</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="n">currentFile</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">circosConfigFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">())</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customizedSizes</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">circosConfigFile</span><span class="o">.</span><span class="n">customized_rewrite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">())</span>
		<span class="n">circosconfigchr</span> <span class="o">=</span> <span class="n">CircosConfigChromosome</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brainparts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colorlist</span><span class="p">())</span>
		<span class="n">circosconfigchr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">())</span></div>

<div class="viewcode-block" id="CircosPlotBuilder.run_circos"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder.run_circos">[docs]</a>	<span class="k">def</span> <span class="nf">run_circos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">j</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">ExecutableJob</span><span class="p">(</span><span class="s1">&#39;circos&#39;</span><span class="p">,</span> <span class="n">rootconfig</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">circos</span><span class="p">,</span> <span class="n">wd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">())</span>
		<span class="n">j</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

<div class="viewcode-block" id="CircosPlotBuilder.plot"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotBuilder.plot">[docs]</a>	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top_left</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">top_right</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bottom_left</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bottom_right</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">copy_files</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">write_files</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">run_circos</span><span class="p">()</span>
		<span class="n">generatedpng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="s1">&#39;circos.png&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">generatedpng</span><span class="p">):</span>
			<span class="n">decorator</span> <span class="o">=</span> <span class="n">CircosPlotDecorator</span><span class="p">(</span><span class="n">generatedpng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfilepath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">top_left</span><span class="p">,</span> <span class="n">top_right</span><span class="p">,</span> <span class="n">bottom_left</span><span class="p">,</span> <span class="n">bottom_right</span><span class="p">)</span>
			<span class="n">finalpng</span> <span class="o">=</span> <span class="n">decorator</span><span class="o">.</span><span class="n">decorate_figure</span><span class="p">()</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">finalpng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfilepath</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="CircosPlotDecorator"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotDecorator">[docs]</a><span class="k">class</span> <span class="nc">CircosPlotDecorator</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	CircosPlotDecorator is used to add titles and detailed information on four corners of circos plot</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infilepath</span><span class="p">,</span> <span class="n">outfilepath</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">top_left</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">top_right</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bottom_left</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bottom_right</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Specify detailed information (strings) to be added in a list and pass arguments to the appropriate position</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">infilepath</span> <span class="o">=</span> <span class="n">infilepath</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">outfilepath</span> <span class="o">=</span> <span class="n">outfilepath</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">top_left</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
			<span class="n">top_left</span> <span class="o">=</span> <span class="p">[</span><span class="n">top_left</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">top_right</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
			<span class="n">top_right</span> <span class="o">=</span> <span class="p">[</span><span class="n">top_right</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bottom_left</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
			<span class="n">bottom_left</span> <span class="o">=</span> <span class="p">[</span><span class="n">bottom_left</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bottom_right</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
			<span class="n">bottom_right</span> <span class="o">=</span> <span class="p">[</span><span class="n">bottom_right</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">top_left</span> <span class="o">=</span> <span class="n">top_left</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">top_right</span> <span class="o">=</span> <span class="n">top_right</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bottom_left</span> <span class="o">=</span> <span class="n">bottom_left</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bottom_right</span> <span class="o">=</span> <span class="n">bottom_right</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">new_image</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="CircosPlotDecorator.decorate_figure"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotDecorator.decorate_figure">[docs]</a>	<span class="k">def</span> <span class="nf">decorate_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infilepath</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">padtop</span> <span class="o">=</span> <span class="mi">200</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">padtop</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">new_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">padtop</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">new_image</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">padtop</span><span class="p">))</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">add_title</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">decorate_corner</span><span class="p">()</span>

		<span class="n">newpng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infilepath</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_decorated.png&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">new_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">newpng</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">newpng</span></div>

<div class="viewcode-block" id="CircosPlotDecorator.add_title"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotDecorator.add_title">[docs]</a>	<span class="k">def</span> <span class="nf">add_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_image</span><span class="p">)</span>
		<span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="s1">&#39;arial.ttf&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
		<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_image</span><span class="o">.</span><span class="n">size</span>
		<span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">(((</span><span class="n">width</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircosPlotDecorator.decorate_corner"><a class="viewcode-back" href="../../../mmdps.vis.html#mmdps.vis.braincircos.CircosPlotDecorator.decorate_corner">[docs]</a>	<span class="k">def</span> <span class="nf">decorate_corner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_image</span><span class="o">.</span><span class="n">size</span>
		<span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_image</span><span class="p">)</span>
		<span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="s1">&#39;arial.ttf&#39;</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">h_cursor</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_left</span><span class="p">:</span>
				<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textsize</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
				<span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_cursor</span> <span class="o">+</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">info</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
				<span class="n">h_cursor</span> <span class="o">+=</span> <span class="n">h</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">h_cursor</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_right</span><span class="p">:</span>
				<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textsize</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
				<span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">width</span> <span class="o">-</span> <span class="n">w</span><span class="p">,</span> <span class="n">h_cursor</span> <span class="o">+</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">info</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
				<span class="n">h_cursor</span> <span class="o">+=</span> <span class="n">h</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textsize</span><span class="p">(</span><span class="s1">&#39;test text&#39;</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
			<span class="n">h_cursor</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_left</span><span class="p">)</span> <span class="o">*</span> <span class="n">h</span> <span class="o">-</span> <span class="n">h</span>
			<span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_left</span><span class="p">:</span>
				<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textsize</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
				<span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_cursor</span> <span class="o">+</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">info</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
				<span class="n">h_cursor</span> <span class="o">+=</span> <span class="n">h</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textsize</span><span class="p">(</span><span class="s1">&#39;test text&#39;</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
			<span class="n">h_cursor</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_right</span><span class="p">)</span> <span class="o">*</span> <span class="n">h</span> <span class="o">-</span> <span class="n">h</span>
			<span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottom_right</span><span class="p">:</span>
				<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textsize</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
				<span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">width</span> <span class="o">-</span> <span class="n">w</span><span class="p">,</span> <span class="n">h_cursor</span> <span class="o">+</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">info</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
				<span class="n">h_cursor</span> <span class="o">+=</span> <span class="n">h</span></div></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">netname</span> <span class="o">=</span> <span class="s1">&#39;bold_net&#39;</span>
	<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;TestCircos&#39;</span>
	<span class="n">outfilepath</span> <span class="o">=</span> <span class="s1">&#39;boldnet&#39;</span>

	<span class="n">fu</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Fusion object</span>
	<span class="n">mriscan</span> <span class="o">=</span> <span class="s1">&#39;zhang_20101010&#39;</span>

	<span class="n">atlasobj</span> <span class="o">=</span> <span class="n">fu</span><span class="o">.</span><span class="n">atlasobj</span>
	<span class="n">net</span> <span class="o">=</span> <span class="n">fu</span><span class="o">.</span><span class="n">nets</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">mriscan</span><span class="p">,</span> <span class="n">netname</span><span class="p">)</span>
	<span class="n">attr</span> <span class="o">=</span> <span class="n">fu</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">mriscan</span><span class="p">,</span> <span class="s1">&#39;bold_interWD&#39;</span><span class="p">)</span>
	<span class="n">builder</span> <span class="o">=</span> <span class="n">CircosPlotBuilder</span><span class="p">(</span><span class="n">atlasobj</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">outfilepath</span><span class="p">)</span>
	<span class="n">builder</span><span class="o">.</span><span class="n">add_circosvalue</span><span class="p">(</span><span class="n">CircosValue</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
	<span class="n">builder</span><span class="o">.</span><span class="n">add_circosvalue</span><span class="p">(</span><span class="n">CircosValue</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
	<span class="n">builder</span><span class="o">.</span><span class="n">add_circosvalue</span><span class="p">(</span><span class="n">CircosValue</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)))</span>
	<span class="n">builder</span><span class="o">.</span><span class="n">add_circoslink</span><span class="p">(</span><span class="n">CircosLink</span><span class="p">(</span><span class="n">net</span><span class="p">))</span>
	<span class="c1"># builder.customizeSize(&#39;0.83r&#39;, &#39;40p&#39;) # brodmann_lr and brodmann_lrce</span>
	<span class="n">builder</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">MMDPS</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../mmdps.html">mmdps package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, mmdp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.9</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>